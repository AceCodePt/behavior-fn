<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>json-template: Curly Brace Syntax Example</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    
    .user-card {
      border: 2px solid #ddd;
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1rem 0;
    }
    
    .user-card[data-role="admin"] {
      border-color: #e63946;
      background: #fff5f5;
    }
    
    .user-card[data-role="moderator"] {
      border-color: #f77f00;
      background: #fff8f0;
    }
    
    .user-card[data-role="user"] {
      border-color: #06a77d;
      background: #f0fdf9;
    }
    
    .post-list {
      list-style: none;
      padding: 0;
    }
    
    .post-list li {
      padding: 0.5rem;
      margin: 0.5rem 0;
      background: #f8f9fa;
      border-radius: 4px;
    }
    
    .post-title {
      font-weight: bold;
      color: #1a73e8;
    }
    
    .post-date {
      color: #666;
      font-size: 0.875rem;
    }
    
    button {
      background: #1a73e8;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      margin: 0.5rem 0.5rem 0.5rem 0;
    }
    
    button:hover {
      background: #1557b0;
    }
  </style>
</head>
<body>
  <h1>json-template: Curly Brace Syntax Demo</h1>
  
  <div style="background: #fffacd; padding: 1rem; border-radius: 4px; margin: 1rem 0; border-left: 4px solid #ffd700;">
    <p style="margin: 0;"><strong>ðŸ’¡ Note:</strong> This example shows the nested object pattern. For simpler use cases where your data is a root-level array, check out <a href="root-array-example.html">root-array-example.html</a> for an even cleaner pattern!</p>
  </div>
  
  <div>
    <button onclick="loadUserData()">Load User 1</button>
    <button onclick="loadUserData2()">Load User 2</button>
    <button onclick="updateUserData()">Add Post</button>
  </div>

  <!-- JSON Data Source -->
  <script type="application/json" id="user-data">
  {
    "user": {
      "name": "Sagi Cohen",
      "email": "sagi@example.com",
      "role": "admin",
      "joined": "2024-01-01"
    },
    "stats": {
      "posts": 15,
      "followers": 42,
      "following": 23
    },
    "posts": [
      { "id": 1, "title": "Getting Started with BehaviorFN", "date": "2024-01-01", "likes": 10 },
      { "id": 2, "title": "Understanding Web Components", "date": "2024-01-15", "likes": 25 },
      { "id": 3, "title": "Building Reactive UIs", "date": "2024-02-01", "likes": 18 }
    ]
  }
  </script>

  <!-- Template Container -->
  <div is="behavioral-json-template" behavior="json-template" json-template-for="user-data">
    <template>
      <!-- User Card with dynamic data-role attribute -->
      <div class="user-card" data-role="{user.role}">
        <h2>{user.name}</h2>
        <p>Email: {user.email}</p>
        <p>Role: {user.role} | Joined: {user.joined}</p>
        
        <!-- Stats with mixed static/dynamic content -->
        <div style="margin-top: 1rem;">
          <strong>Stats:</strong> 
          {stats.posts} posts â€¢ 
          {stats.followers} followers â€¢ 
          {stats.following} following
        </div>
        
        <!-- Posts Array -->
        <h3 style="margin-top: 1.5rem;">Recent Posts</h3>
        <ul class="post-list">
          <template data-array="posts">
            <li>
              <span class="post-title">{title}</span><br>
              <span class="post-date">{date} â€¢ {likes} likes</span>
            </li>
          </template>
        </ul>
      </div>
    </template>
  </div>

  <!-- Nested Arrays Example -->
  <h2 style="margin-top: 3rem;">Nested Arrays Example</h2>
  
  <script type="application/json" id="departments-data">
  {
    "company": "TechCorp",
    "departments": [
      {
        "name": "Engineering",
        "employees": [
          { "name": "Alice", "position": "Senior Developer" },
          { "name": "Bob", "position": "DevOps Engineer" }
        ]
      },
      {
        "name": "Design",
        "employees": [
          { "name": "Charlie", "position": "UI Designer" },
          { "name": "Diana", "position": "UX Researcher" }
        ]
      }
    ]
  }
  </script>

  <div is="behavioral-json-template" behavior="json-template" json-template-for="departments-data">
    <template>
      <div>
        <h3>{company} Departments</h3>
        <div>
          <template data-array="departments">
            <div style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 4px;">
              <h4>{name}</h4>
              <ul>
                <template data-array="employees">
                  <li>{name} - {position}</li>
                </template>
              </ul>
            </div>
          </template>
        </div>
      </div>
    </template>
  </div>

  <!-- Web Component Integration Example -->
  <h2 style="margin-top: 3rem;">Web Component Integration</h2>
  <p>Click to open a modal with dynamic content:</p>
  
  <button commandfor="dynamic-modal" command="--toggle">Open Modal</button>
  
  <script type="application/json" id="modal-data">
  {
    "title": "Important Notice",
    "content": "This modal was created using json-template with curly brace syntax!",
    "footer": "Click outside to close"
  }
  </script>

  <div is="behavioral-json-template" behavior="json-template" json-template-for="modal-data">
    <template>
      <!-- Note: is="behavioral-reveal" would be preserved if reveal behavior is registered -->
      <dialog id="dynamic-modal" style="padding: 2rem; border: none; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <h2>{title}</h2>
        <p>{content}</p>
        <hr style="margin: 1rem 0;">
        <small style="color: #666;">{footer}</small>
        <form method="dialog" style="margin-top: 1rem;">
          <button type="submit">Close</button>
        </form>
      </dialog>
    </template>
  </div>

  <script>
    // Load behavior registry (in real app, this would be from CDN or bundler)
    // For demo purposes, we'll add minimal polyfill for behavioral host
    
    if (!customElements.get('behavioral-json-template')) {
      customElements.define('behavioral-json-template', class extends HTMLDivElement {
        constructor() {
          super();
        }
      }, { extends: 'div' });
    }

    // Demo functions to update data
    function loadUserData() {
      document.getElementById('user-data').textContent = JSON.stringify({
        "user": {
          "name": "Jane Doe",
          "email": "jane@example.com",
          "role": "moderator",
          "joined": "2024-06-15"
        },
        "stats": {
          "posts": 8,
          "followers": 125,
          "following": 67
        },
        "posts": [
          { "id": 1, "title": "My First Post", "date": "2024-06-15", "likes": 5 }
        ]
      }, null, 2);
    }

    function loadUserData2() {
      document.getElementById('user-data').textContent = JSON.stringify({
        "user": {
          "name": "Alex Smith",
          "email": "alex@example.com",
          "role": "user",
          "joined": "2024-11-20"
        },
        "stats": {
          "posts": 3,
          "followers": 12,
          "following": 8
        },
        "posts": [
          { "id": 1, "title": "Hello World", "date": "2024-11-20", "likes": 2 },
          { "id": 2, "title": "Learning Web Components", "date": "2024-11-25", "likes": 4 }
        ]
      }, null, 2);
    }

    function updateUserData() {
      const currentData = JSON.parse(document.getElementById('user-data').textContent);
      currentData.posts.push({
        id: currentData.posts.length + 1,
        title: "New Post " + (currentData.posts.length + 1),
        date: new Date().toISOString().split('T')[0],
        likes: 0
      });
      currentData.stats.posts = currentData.posts.length;
      document.getElementById('user-data').textContent = JSON.stringify(currentData, null, 2);
    }

    // Polyfill for commandfor/command (Invoker Commands API)
    document.addEventListener('click', (e) => {
      const button = e.target.closest('[commandfor]');
      if (!button) return;
      
      const targetId = button.getAttribute('commandfor');
      const command = button.getAttribute('command');
      const target = document.getElementById(targetId);
      
      if (target && command === '--toggle') {
        if (target.open) {
          target.close();
        } else {
          target.showModal();
        }
      }
    });
  </script>
</body>
</html>
